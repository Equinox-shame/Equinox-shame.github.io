
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RARPasswordRecovery 逆向分析 - Autumnal</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="Crack  by  混入21的蒟蒻
暴力破解运行安装包，安装对应的软件，拖入PE进行查壳分析，发现有一个 UPX 壳，直接利用 UPX.exe脱壳

脱去壳后拉入IDA分析
寻找对应的Regist,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Autumnal" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Autumnal</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">RARPasswordRecovery 逆向分析</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">RARPasswordRecovery 逆向分析</h1>
        <div class="stuff">
            <span>三月 14, 2022</span>
            

        </div>
        <div class="content markdown">
            <h2 id="Crack-by-混入21的蒟蒻"><a href="#Crack-by-混入21的蒟蒻" class="headerlink" title="Crack  by  混入21的蒟蒻"></a>Crack  by  混入21的蒟蒻</h2><hr>
<h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><p>运行安装包，安装对应的软件，拖入<code>PE</code>进行查壳分析，发现有一个 <code>UPX</code> 壳，直接利用 <code>UPX.exe</code>脱壳</p>
<p><img src="https://s3.bmp.ovh/imgs/2021/11/5e747896d3964ab7.png"></p>
<p>脱去壳后拉入<code>IDA</code>分析</p>
<p>寻找对应的<code>Register</code>可以发现如下字符串 ：</p>
<p><img src="https://s3.bmp.ovh/imgs/2021/11/78b9fa1a17f66358.png"></p>
<p>寻找对应的<code>The Code you&#39;ve entered invalid!</code>之后我们利用对应的交叉引用进行查找有关函数而对程序进行分析，可以找到如下函数 ：</p>
<p><img src="https://static01.imgkr.com/temp/8a9bc7575c154ed4b7d36096d063131d.png"></p>
<p><img src="https://s3.bmp.ovh/imgs/2021/11/c035d0e6f8572a68.png"></p>
<p>之后跳转到图形界面进行分析 ：</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/df848f56ed92542f.png"></p>
<p>结合动态调试可以发现这 3 个函数会对程序获取到的密钥进行判断，如果为<code>True</code>则直接跳转到下面的<code>The Code you&#39;ve entered invalid!</code>此时我们的注册环节就失败了，如果需要跳转到注册成功的界面那么我们需要在每一次的判断中都是<code>False</code>这样我们才能跳转到提示注册成功。</p>
<p>那么暴力破解这个就变得十分简单了，我们只需要更改对应的<code>jz/jnz</code>这两个跳转使其互换，那么就可以达到我们的目的了。</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/7f09bb11d3a1e51e.png"></p>
<p>之后我们将补丁打上就完成了对应的注册暴力破解。</p>
<hr>
<h2 id="注册机"><a href="#注册机" class="headerlink" title="注册机"></a>注册机</h2><h3 id="注册条件判断"><a href="#注册条件判断" class="headerlink" title="注册条件判断"></a>注册条件判断</h3><p><img src="https://obohe.com/i/2021/11/21/4udi5.png"></p>
<p>在之前暴力破解时我们找到了对应的提示框显示的位置，可以明显的看到有一个<code>if</code>对 4 个表达式进行判断，如果要完成注册机的编写我们则需要让 4 个等式都成立即可，而这个也会是我们编写注册机的关键之处。</p>
<hr>
<h4 id="第一个条件"><a href="#第一个条件" class="headerlink" title="第一个条件"></a>第一个条件</h4><p>我们简单的动态调试一下发现只要第一个判断条件是对输入的数据长度进行判断，如果长度为 0 那么函数就会直接跳转到下面的<code>The Code you&#39;ve entered invalid!</code>处，也就是意味着在第一个判断处我们仅需要保证输入的长度是大于<code>0</code>的就可以实现跳转到第二个条件中。</p>
<hr>
<h4 id="第二个条件"><a href="#第二个条件" class="headerlink" title="第二个条件"></a>第二个条件</h4><p>通过上图的汇编可以明显地发现有一个<code>test</code>函数，我们需要做的是让<code>test</code>函数的值为 1，也就是<code>eax</code>的值不为空，那么关键就是<code>call</code>里面的函数<code>_wcsstr</code>。我们点击进入该函数，进行分析。</p>
<img src="https://i.bmp.ovh/imgs/2021/11/3a63b21f8f5bbb79.png" style="zoom: 50%;" />

<p>通过图形化的界面我们可以看到程序的大致流程，我们通过输入进行测试，观察具体执行过程。</p>
<p>我们随意输入一串数字<code>123456789</code>进行测试，在流程中我们会在寄存器经常看到<code>DA</code> ：</p>
<p>​                                                                               <img src="https://i.bmp.ovh/imgs/2021/11/c3500131c19c76fe.png"> </p>
<p>经过一轮下来的动调发现，程序会一直在如下区间内一直循环 ：</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/187c71a1437aa093.png"></p>
<p>如果你常常看寄存器里的值你会发现在寄存器里你输入的值会一个个被<code>pop</code>掉（一直往下寻址），此时我们也通过浏览器查询<code>_wcsstr</code>函数作用企图获得一些灵感，在百度百科中介绍该函数是一个寻找的字符的一个函数 ：</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/3e23d6f8e59918a9.png"></p>
<p>这或许就解释了在<code>EDI</code>寄存器中为什么我们的输入会一值向下寻址，可能就是在寻找寄存器中出现的<code>DA</code> ？我们更改一下我们的测试密钥更改成<code>DADADADADA</code>，再次对其进行测试。同样的我们在寄存器里会发现当读入我们的一个数据后出现了<code>AOOSOFT-RAR-RECOVERY</code>，感觉是不是有一点熟悉？</p>
<p>是不是少了一个<code>D</code>，不然就是程序的名字，我们继续按<code>F8</code>测试会发现在寄存器<code>ECX</code>中<code>AOSSOFT-RAR-RECOVERY</code>会变成<code>OSSOFT-RAR-RECOVERY</code>但是继续调试过一个循环会发现又变成成了<code>AOSSOFT-RAR-RECOVERY</code>，但是读入<code>A</code>时又成了<code>OSSOFT-RAR-RECOVERY</code>，我们比那会很疑惑这个密钥是不是与程序的名字<code>DAOSSOFT-RAR-RECOVERY</code>有关系，我们再次改变密钥为<code>DAdsaddasd4152</code>，动调还是会发现<code>ECX</code>中<code>AOSSOFT-RAR-RECOVERY</code>会变成<code>OSSOFT-RAR-RECOVERY</code>但是继续调试读入的数据是<code>d</code>时<code>OSSOFT-RAR-RECOVERY</code>就变回了<code>DA</code>,因此我们确定了输入与密钥的部分关系——密钥开头<code>DAOSSOFT-RAR-RECOVERY</code>。</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/775ef29a79e0b9d2.png"></p>
<p>至此我们就已经通过了两个条件了。</p>
<hr>
<h4 id="第三个条件"><a href="#第三个条件" class="headerlink" title="第三个条件"></a>第三个条件</h4><p>通过第二个条件时我们可以在寄存器里发现我们的输入会被存储于<code>EAX</code>寄存器中  ：</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/a2575782c23cdc67.png"></p>
<p>同样的我们回到汇编层去分析程序 ：</p>
<p><img src="https://i.bmp.ovh/imgs/2021/11/e8cfc242d1760495.png"></p>
<p>可以较为明显的看到，函数在第三个条件判断中运行了一次减法和一次右移的操作，我们要想通过，那么就需要保证在第二次测试的输入<code>DAOSSOFT-RAR-RECOVERY</code>保证后面有值进行运算减法和一次右移过后的值不为 0 就可以通过了，例如在<code>DAOSSOFT-RAR-RECOVERY</code>后添加一部分数字或者一部分字母，便可以通过第三个条件。</p>
<hr>
<h4 id="第四个条件"><a href="#第四个条件" class="headerlink" title="第四个条件"></a>第四个条件</h4><p><img src="https://obohe.com/i/2021/11/21/hc1uh0.png"></p>
<p>进入第四个条件时，通过汇编可以看到<code>ECX</code>的值等于<code>EBX</code>，同时将<code>ECX</code>入栈，下面有一个<code>Call</code>指令，调用了一个函数，而下面就是<code>test al al</code>，如果我们将鼠标放到<code>al</code>上，你会发现<code>al</code>的值为 0 ，那么意味着如果要进入到<code>if</code>语句内部那么<code>al</code>的只会在<code>call</code>的函数中发生改变，此时我们分析的重点便落到了<code>call sub_417CE0 </code>中。</p>
<p>进入该函数，我们转换成<code>C的伪代码</code>形式，进行判断该函数的作用。</p>
<img src="https://obohe.com/i/2021/11/21/hgrz7t.png"  />

<p>进入后发现函数里面会有一大堆东西，其中大部分是去掉了函数名称，但是我们仍然可以在其中找到一些东西，<code>wcshr</code>和<code>__InterlockedDecrement</code>两个函数名，经过百度我们可以了解到其相关信息。</p>
<blockquote>
<p><strong>wcshr</strong></p>
<p><img src="https://obohe.com/i/2021/11/21/i6x5y5.png"></p>
<p><strong>__InterlockedDecrement</strong></p>
<p>百度后发现其类似于一种线程锁的东西？防止删除自己，因此我们便不用花费大量时间纠结于下面&gt;的一堆<code>if</code>判断语句中。</p>
</blockquote>
<p>通过分析<code>wcshr</code>函数内部有一个<code>Stra</code>和一个<code>0x2Du</code>，通过十六进制我们可以看到<code>0x2Du</code>的值为<code>-</code>，那么那条语句的作用便是在<code>Stra</code>中寻找<code>-</code> 。</p>
<p><strong>前面是不是还有一些函数，它们的作用会是什么呢 ?</strong></p>
<p>同样的在动态调试下我们通过单步步入和步出的组合进行观察和判断，并检测<code>Stra</code>的值，当我们动态调试过<code>Stra</code>处时将鼠标放在上面，你会发现<code>Stra</code>的函数值便是我们输入的值，但在经过后面两个函数过后你便会发现<code>Stra</code>变成固定开头后内容了。</p>
<p>之后便是我们的判断语句<code>if</code>，在判断条件中我们明显的可以看到判断的条件是<code>Stra</code>的长度要大于 3 ，之后再其中寻找<code>-</code>的位置返回给<code>v2</code>，如果寻找到了则会进行<code>v1 = v2 - Stra</code>，我们在动调下不难发现<code>v1</code>的长度便是固定开头后内容的长度减去<code>Stra</code>中带有<code>-</code>后边部分的长度。</p>
<p>在这个判断中我们需要做的就是让<code>v1</code>的值不为<code>-1</code>和<code>0</code>即可，之后的大多数函数都是不用进行过多的分析。</p>
<hr>
<h3 id="注册程序编写"><a href="#注册程序编写" class="headerlink" title="注册程序编写"></a>注册程序编写</h3><p>经过上面的分析过后我们便可以成功的进行注册，程序会弹出来恭喜注册成功的提示 ：</p>
<p>​                                                                 <img src="https://obohe.com/i/2021/11/21/isfzou.png"></p>
<p><strong>那么我们注册机应该怎么写呢？</strong></p>
<p>我们再次简单的整理一下上述密钥的判断过程，可以得知密钥是以<code>DAOSSOFT-RAR-RECOVERY</code>为开头的，之后的输入都要满足之前的条件，要存在有<code>-</code>，使我们的最后一个条件成立——即<code>v1</code>不为<code>-1</code>和<code>0</code>即可。</p>
<p>分析过后我们便可以开始完成我们的编写，脚本如下。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function">string <span class="title">rand_str</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">    <span class="comment">/*初始化*/</span></span><br><span class="line">    string str;                 <span class="comment">/*声明用来保存随机字符串的str*/</span></span><br><span class="line">    <span class="keyword">char</span> c;                     <span class="comment">/*声明字符c，用来保存随机生成的字符*/</span></span><br><span class="line">    <span class="keyword">int</span> idx;                    <span class="comment">/*用来循环的变量*/</span></span><br><span class="line">    <span class="comment">/*循环向字符串中添加随机生成的字符*/</span></span><br><span class="line">    <span class="keyword">for</span>(idx = <span class="number">0</span>;idx &lt; len;idx ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*rand()%26是取余，余数为0~25加上&#x27;a&#x27;,就是字母a~z,详见asc码表*/</span></span><br><span class="line">        c = <span class="string">&#x27;a&#x27;</span> + <span class="built_in">rand</span>()%<span class="number">26</span>;</span><br><span class="line">        str.<span class="built_in">push_back</span>(c);       <span class="comment">/*push_back()是string类尾插函数。这里插入随机字符c*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;                 <span class="comment">/*返回生成的随机字符串*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	string str1,str2;</span><br><span class="line">	str1=<span class="built_in">rand_str</span>(<span class="number">3</span>);</span><br><span class="line">	str2=<span class="built_in">rand_str</span>(<span class="number">3</span>);</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;您的密钥为：&quot;</span>&lt;&lt;<span class="string">&quot;DAOSSOFT-RAR-RECOVERY&quot;</span>&lt;&lt;str1&lt;&lt;<span class="string">&quot;-&quot;</span>&lt;&lt;str2&lt;&lt;endl; </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此我们便完成了所有的破解工作。</p>
<hr>
<h2 id="魔改"><a href="#魔改" class="headerlink" title="魔改"></a>魔改</h2><p>那么对于这个程序我们是否可以魔改呢？</p>
<p>答案是肯定的。我们分析出来了程序的注册流程，我们便可以对其注册部分进行魔改，也可以对其输入输出的文本框进行修改。</p>
<h3 id="改变密钥"><a href="#改变密钥" class="headerlink" title="改变密钥"></a>改变密钥</h3><p>我们根据上面的密钥分析我们可以得到对应的注册密钥是以<code>DAOSSOFT-RAR-RECOVERY</code>为开头的，那我们也可以更改对应的值，使其成为我们独有的加密。</p>
<p>我们找到<code>DAOSSOFT-RAR-RECOVERY</code>对应所在的位置，进行更改 ：</p>
<p><img src="https://obohe.com/i/2021/11/21/k5xfdv.png"></p>
<p>之后进行测试 ：</p>
<p><img src="https://obohe.com/i/2021/11/21/k5xids.png"></p>
<p>发现同样可以注册成功，完成我们的密钥魔改。</p>
<h3 id="标题修改"><a href="#标题修改" class="headerlink" title="标题修改"></a>标题修改</h3><p>我们同样的定位对应的数据位置，对其进行更改便可以达到与修改密钥一样的方式完成对应的修改过程，此处就不贴上对应的图了。</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                </ul>
            
        </div>
        

    <div id='gitalk-container' class="comment link"
		data-enable='false'
        data-ae='false'
        data-ci='01ed89abee289d37f2f8'
        data-cs='51741e819059e2ea7ab6c6f3d0fa0ac631d1d975'
        data-r='equinox-shame.github.io'
        data-o='Equinox-shame'
        data-a='Equinox-shame'
        data-d='false'
    >查看评论</div>


        
    </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




</html>
