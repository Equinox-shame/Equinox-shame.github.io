

<!DOCTYPE html>
<html lang="zh" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="梓曰">
  <meta name="keywords" content="">
  
    <meta name="description" content="程序分类控制台应用程序(DOS 程序)本质上是一个DOS程序，本身没有窗口，通过Windows DOS窗口执行 窗口程序拥有自己的窗口，可以与用户交互 库程序存放代码数据的程序，执行文件可以从中取出代码执行和获取数据  静态库程序：扩展名lib，在编译链接程序时，将代码放入到执行文件中，无法执行 ( 没有入口函数 ) 动态库程序：扩展名dll，执行文件时从中获取代码，不能独立运行，需要依附其他程序">
<meta property="og:type" content="article">
<meta property="og:title" content="Win 32 编程">
<meta property="og:url" content="https://equinox-shame.github.io/2022/04/07/Win32%20%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="Autumnal">
<meta property="og:description" content="程序分类控制台应用程序(DOS 程序)本质上是一个DOS程序，本身没有窗口，通过Windows DOS窗口执行 窗口程序拥有自己的窗口，可以与用户交互 库程序存放代码数据的程序，执行文件可以从中取出代码执行和获取数据  静态库程序：扩展名lib，在编译链接程序时，将代码放入到执行文件中，无法执行 ( 没有入口函数 ) 动态库程序：扩展名dll，执行文件时从中获取代码，不能独立运行，需要依附其他程序">
<meta property="og:locale">
<meta property="og:image" content="https://s2.loli.net/2022/04/09/I1lEPyRSDTWdf5o.png">
<meta property="article:published_time" content="2022-04-06T16:14:39.387Z">
<meta property="article:modified_time" content="2022-04-09T13:35:21.365Z">
<meta property="article:author" content="梓曰">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2022/04/09/I1lEPyRSDTWdf5o.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Win 32 编程 - Autumnal</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"equinox-shame.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"2aM6IUUWOeDGCZaDdRhrvLam-gzGzoHsz","app_key":"GQdXw2PjI9DScgw5QHVCZeYm","server_url":"https://2am6iuuw.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Autumnal Equinox</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Win 32 编程"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-04-07 00:14" pubdate>
          April 7, 2022 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k wörter
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          142 minuten
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> ansichten
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Win 32 编程</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="程序分类"><a href="#程序分类" class="headerlink" title="程序分类"></a>程序分类</h2><h3 id="控制台应用程序-DOS-程序"><a href="#控制台应用程序-DOS-程序" class="headerlink" title="控制台应用程序(DOS 程序)"></a>控制台应用程序(DOS 程序)</h3><p>本质上是一个<code>DOS</code>程序，本身没有窗口，通过<code>Windows DOS</code>窗口执行</p>
<h3 id="窗口程序"><a href="#窗口程序" class="headerlink" title="窗口程序"></a>窗口程序</h3><p>拥有自己的窗口，可以与用户交互</p>
<h3 id="库程序"><a href="#库程序" class="headerlink" title="库程序"></a>库程序</h3><p>存放代码数据的程序，执行文件可以从中取出代码执行和获取数据</p>
<ul>
<li>静态库程序：扩展名<code>lib</code>，在编译链接程序时，将代码放入到执行文件中，无法执行 ( 没有入口函数 )</li>
<li>动态库程序：扩展名<code>dll</code>，执行文件时从中获取代码，不能独立运行，需要依附其他程序运行 ( 有入口函数 )</li>
</ul>
<h2 id="编译工具"><a href="#编译工具" class="headerlink" title="编译工具"></a>编译工具</h2><p>编译器<code>cl.exe</code>：将源代码编译成目标代码<code>.obj</code><br>链接器<code>link.exe</code>：将目标代码、库链接生成最终文件<br>资源编译器<code>rc.exe</code>：( .rc ) 将资源编译，最终通过链接器存入最终文件 ( 一种脚本语言 )</p>
<h2 id="库函数"><a href="#库函数" class="headerlink" title="库函数"></a>库函数</h2><p><code>kernel32.dll</code>：提供了核心的<code>API</code>，例如进程、线程、内存管理等<br><code>user32.dll</code>：提供了窗口、消息等<code>API</code><br><code>gdi32.dll</code>：绘图相关的<code>API</code></p>
<h2 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h2><p><code>windows.h</code>：所有<code>Windows</code>头文件的集合<br><code>windef.h</code>：<code>Windows</code>数据类型 ( <code>typdef</code>对基本数据类型取别名实现的 )<br><code>winbase.h</code>：<code>kernel32</code>的<code>API</code><br><code>wingdi.h</code>：<code>gdi32</code>的<code>API</code><br><code>winuser.h</code>：<code>user32</code>的<code>API</code><br><code>winnt.h</code>：<code>Unicode</code>字符集支持</p>
<blockquote>
<p>一般写一个<code>Windows.h</code>即可</p>
</blockquote>
<h2 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">	    	CL.exe<br><span class="hljs-string">.c/.cpp----------------------</span>&gt; <span class="hljs-string">.obj</span>  |	 	LINK.exe<br>			RC.exe			       | <span class="hljs-params">---------------------</span>&gt; <span class="hljs-string">.exe</span> <br><span class="hljs-string">.rc--------------------------</span>&gt; <span class="hljs-string">.res</span>  |<br></code></pre></td></tr></table></figure>

<h2 id="宽字节字符"><a href="#宽字节字符" class="headerlink" title="宽字节字符"></a>宽字节字符</h2><p><code>wchar_t</code>每个字符占两个字节，其本质上是<code>unsigned short</code>类型，定义时，需要增加 “L” ，通知编译器按照双字节编译字符串，采用<code>Unicode</code>编码，同时对宽字节字符串操作时需要使用相关支持宽字节的函数。<code>wprintf</code>对<code>Unicode</code>字符打印支持并不完善，在<code>Windows</code>下使用<code>WriteConsole</code>进行输出。</p>
<h2 id="窗口类"><a href="#窗口类" class="headerlink" title="窗口类"></a>窗口类</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li><p>窗口类包含了窗口的各种参数信息的数据结构</p>
</li>
<li><p>每个窗口都具有窗口类，基于窗口类创建窗口</p>
</li>
<li><p>每个窗口类都具有一个名称，使用前必须注册到系统</p>
</li>
</ul>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>系统窗口类：系统已经定义好的窗口类，所有应用程序都可以直接使用</p>
<p>应用程序全局窗口类：由用户自己定义，当前应用程序所有模块都可以直接使用</p>
<p>应用程序局部窗口类：由用户自己定义，当前应用程序中本模块可以使用</p>
<h2 id="资源类"><a href="#资源类" class="headerlink" title="资源类"></a>资源类</h2><h3 id="菜单"><a href="#菜单" class="headerlink" title="菜单"></a>菜单</h3><h4 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h4><p>窗口的顶层菜单<br>弹出式菜单<br>系统菜单</p>
<p><code>HMENU</code>类型( 菜单句柄 )表示菜单，<code>ID</code>表示菜单项。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HMENU <span class="hljs-title">LoadMenu</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,	<span class="hljs-comment">//handle to module</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpMenuName	<span class="hljs-comment">// menu name or resource identifier</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>加载菜单资源</p>
<p>1&gt;注册窗口类时设置菜单<br>2&gt;创建窗口传参设置菜单<br>3&gt;在主窗口WM_CREATE消息中利用<code>SetMenu</code>函数设置菜单</p>
</blockquote>
<h3 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h3><p>一个图标文件中可以有多个不同大小的图标</p>
<p>加载</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HICON <span class="hljs-title">LoadIcon</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,<span class="hljs-comment">// handle to application instance</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpIconName <span class="hljs-comment">// name string or resource identifier</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//成功返回HICON句柄</span><br></code></pre></td></tr></table></figure>

<h3 id="光标"><a href="#光标" class="headerlink" title="光标"></a>光标</h3><p>光标的大小默认是<code>32X32</code>像素，每个光标有<code>HotSpot</code>，是当前鼠标的热点</p>
<p>加载资源</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HCURSOR <span class="hljs-title">LoadCursor</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,<span class="hljs-comment">// handle to application instance</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpCursorName <span class="hljs-comment">// name or resource identifier</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">// hInstance -可以为NULL，获取系统默认的Cursor</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>必须放在消息处理函数中定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HCURSOR <span class="hljs-title">SetCursor</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HCURSOR hCursor <span class="hljs-comment">// handle to cursor</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure>

<p><code>WM_SETCURSOR</code>消息参数</p>
<p><code>wPARAM</code>当前使用的光标句柄<br><code>lPARAM</code>：<code>LOWORD</code>当前区域的代码( Hit-Test code )<br><code>HTCLIENT</code>(  客户区域 ) 、<code>HTCAPTION</code>( 标题栏区域 )…<br><code>HIWORD</code>：当前鼠标消息ID</p>
</blockquote>
<p>设置资源</p>
<p>在注册窗口时，设置光标( 不方便随时改光标 )<br>使用<code>SetCursor</code>设置光标( 可以随时改光标 )</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><blockquote>
<p> 方便实现中英文两版程序</p>
</blockquote>
<p>添加字符串资源</p>
<p>添加字符串表,在表中增加字符串</p>
<p>字符串资源的使用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">LoadString</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,<span class="hljs-comment">// handle to resource module</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT uID,<span class="hljs-comment">//字符串ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPTSTR IpBuffer,<span class="hljs-comment">//存放字符串BUI</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nBufferMax <span class="hljs-comment">//字符串BUFF长度</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//成功返回字符串长度，失败0</span><br></code></pre></td></tr></table></figure>

<h3 id="加速键"><a href="#加速键" class="headerlink" title="加速键"></a>加速键</h3><p>例如快捷键，可以添加对应的<code>ID</code>来对应的快捷操作</p>
<p>加载加速键表</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HACCEL <span class="hljs-title">LoadAccelerators</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,<span class="hljs-comment">// handle to module</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpTableName<span class="hljs-comment">// accelerator table name</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//返回加速键表句柄</span><br></code></pre></td></tr></table></figure>

<p>翻译加速键</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">TranslateAccelerator</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,<span class="hljs-comment">//处理消息的窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HACCEL hAccTable,<span class="hljs-comment">//加速键表句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPMSG lpMsg <span class="hljs-comment">//消息</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//如果是加速键，返回非零。</span><br></code></pre></td></tr></table></figure>

<p>在<code>WM_COMMAND</code>中相应消息，消息参数：</p>
<p><code>wPARAM</code> : <code>HIWORD</code>为 1 表示加速键，为 0 表示菜单。<code>LOWORD</code>为命令<code>ID</code>。</p>
<p><code>lParam</code> ：为0</p>
<h2 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h2><h3 id="消息组成"><a href="#消息组成" class="headerlink" title="消息组成"></a>消息组成</h3><p>窗口句柄、消息ID、消息的两个参数( 两个附带信息 )：消息产生的时间、消息产生时的鼠标位置</p>
<h3 id="消息作用"><a href="#消息作用" class="headerlink" title="消息作用"></a>消息作用</h3><p>当系统通知窗口工作室，就采用消息的方式派发给窗口</p>
<h3 id="相关消息"><a href="#相关消息" class="headerlink" title="相关消息"></a>相关消息</h3><table>
<thead>
<tr>
<th align="center">消息名</th>
<th align="center">产生时间</th>
<th align="center">附带消息</th>
<th align="center">一般用法</th>
</tr>
</thead>
<tbody><tr>
<td align="center">WM_DESTORY</td>
<td align="center">窗口被销毁时的消息</td>
<td align="center"><code>wParam</code>为 0 ，<code> lPARAM</code>为 0</td>
<td align="center">常用于在窗口被销毁之前，做对应的善后处理，例如资源、内存等。</td>
</tr>
<tr>
<td align="center">WM_SYSCOMMAND</td>
<td align="center">当点击窗口的最大化、最小化、关闭等</td>
<td align="center"><code>wParam</code>为具体点击位置，例如关闭SC_CLOSE等 ，<code> lPARAM</code>为鼠标光标的位置。<code>LOWORD(lPARAM);//水平位置HIWORD(lPARAM);//垂直位置</code></td>
<td align="center">常用在窗口关闭时，提示用户处理</td>
</tr>
<tr>
<td align="center">WM_CREATE</td>
<td align="center">窗口创建成功但是还未显示时</td>
<td align="center"><code>wParam</code>为 0 ，<code> lPARAM</code>为 <code>CREATESTRUCT</code>类型的指针。通过这个指针可以获取<code>CreatWindowEX</code>中全部的12个参数的信息</td>
<td align="center">常用于初始化窗口的函数、资源等，包括创建子窗口的等</td>
</tr>
<tr>
<td align="center">WM_SIZE</td>
<td align="center">窗口的大小法神变化后，窗口刚产生时</td>
<td align="center"><code>wParam</code>为窗口变化的原因 ，<code> lPARAM</code>为窗口变化后的大小。<code>LOWORD(lPARAM);//变化后的宽度HIWORD(lPARAM);//变化后的高度</code></td>
<td align="center">常用于窗口大小变化后，调整窗口内各个部分的布局</td>
</tr>
<tr>
<td align="center">WM_QUIT</td>
<td align="center">程序员发送</td>
<td align="center"><code>wParam</code>为<code>PostQuitMessage</code>传递的参数 ，<code> lPARAM</code>为 0</td>
<td align="center">用于结束消息循环，当<code>GetMessage</code>收到这个消息后，返回<code>FALSE</code>，结束<code>while</code>处理，退出消息循环</td>
</tr>
<tr>
<td align="center">WM_PAINT</td>
<td align="center">当窗口需要绘制的时候</td>
<td align="center"><code>wParam</code>为 0 ，<code> lPARAM</code>为 0</td>
<td align="center">用于绘图</td>
</tr>
<tr>
<td align="center">…..</td>
<td align="center">…..</td>
<td align="center">…..</td>
<td align="center">…..</td>
</tr>
</tbody></table>
<h3 id="消息的阻塞"><a href="#消息的阻塞" class="headerlink" title="消息的阻塞"></a>消息的阻塞</h3><p><code>GetMessage</code>：从系统获取消息，将消息从系统中移除，阻塞函数。当系统无消息时，会等候下—条消息。<br><code>PeekMessage</code>：以查看的方式从系统获取消息，可以不将消息从系统移除，非阻塞函数。当系统无消息时，返回<code>FALSE</code>，继续执行后续代码。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">PeekMessage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPMSG lpMsg,<span class="hljs-comment">// message information</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,<span class="hljs-comment">// handle to window</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT wMsgFilterMin，<span class="hljs-comment">// first message</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT wMsgFilterMax，<span class="hljs-comment">// last message</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT wRemoveMsg<span class="hljs-comment">//移除标识</span></span></span><br><span class="hljs-params"><span class="hljs-function">	PM_REMOVE/PM_NOREMOVE</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>消息循环：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>	<span class="hljs-keyword">if</span>(PeekMessage(&amp;nMsg,<span class="hljs-literal">NULL</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,PM_NOREMOVE))&#123;<br>		<span class="hljs-comment">//有消息</span><br>		<span class="hljs-keyword">if</span>(GetMessage(&amp;nMsg,<span class="hljs-literal">NULL</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>))&#123;<br>			TranslateMessage(&amp;nMsg);<br>			DispatchMessage(&amp;nMsg);<span class="hljs-comment">//将消息交给窗口处理函数来处理</span><br>		&#125;<br>	&#125;<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-comment">//无消息</span><br>		wprintf(<span class="hljs-string">L&quot;NO MESSAGE\n&quot;</span>);<br>		Sleep(<span class="hljs-number">100</span>); <br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><p><code>SendMessage</code>：发送消息(直接发送到自己定义的消息处理函数)，会等候消息处理的结果。消息未处理完会造成阻塞。<br><code>PostMessage</code>：投递消息(发送到系统队列)，消息发出后立刻返回，不等候消息执行结果。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">BOOL SendMessage/PostMessage(<br>	HWND hWnd,<span class="hljs-comment">//消息发送的目的窗口</span><br>	UINT Msg,<span class="hljs-comment">//消息ID</span><br>	WPARAM wParam,<span class="hljs-comment">//消息参数</span><br>	LPARAM lParam <span class="hljs-comment">//消息参数</span><br>)<br></code></pre></td></tr></table></figure>

<p>系统消息：ID 范围<code>0 - 0x03FF</code><br>由系统定义好的消息，可以在程序中直接使用。<br>用户自定义消息：ID 范围<code>0x0400 - 0x7FFF(31743)</code><br>由用户自己定义，满足用户自己的需求。由用户自己发出消息，并响应处理。<br>自定义消息宏:<code>WM_USER</code></p>
<h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><h4 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h4><ul>
<li>消息队列是用于存放消息的队列。</li>
<li> 消息在队列中先入先出。</li>
<li>所有窗口程序都具有消息队列。</li>
<li>程序可以从队列中获取消息。</li>
</ul>
<h4 id="分类-2"><a href="#分类-2" class="headerlink" title="分类"></a>分类</h4><p>系统消息队列：由系统维护的消息队列。存放系统产生的消息，例如鼠标、键盘等。<br>程序消息队列：属于每一个应用程序（线程）的消息队列。由应用程序（线程）维护。</p>
<p>根据消息和消息队列之间使用关系，将消息分成两类：</p>
<ul>
<li><p>队列消息 – 消息的发送和获取，都是通过消息队列完成。</p>
<blockquote>
<p>队列消息-消息发送后，首先放入系统消息队列，之后分发道程序消息队列，然后通过消息循环，从队列当中获取。</p>
<p><code>GetMessage</code>：从消息队列中获取消息</p>
<p><code>PostMessage</code>：将消息投递到消息队列</p>
<p>常见队列消息：<code>WM_PAINT</code>、键盘、鼠标、定时器。</p>
</blockquote>
</li>
<li><p>非队列消息 – 消息的发送和获取，是直接调用消息的窗口处理完成。</p>
<blockquote>
<p>非队列消息–消息发送时，首先查找消息接收窗口的窗口处理函数，直接调用处理函数，完成消息。</p>
<p><code>SendMessage</code>：直接将消息发送给窗口的处理函数，并等候处理结果。常见消息：<code>WM_CREATE</code>、<code>WM_SIZE</code>等。</p>
</blockquote>
</li>
</ul>
<h3 id="键盘消息"><a href="#键盘消息" class="headerlink" title="键盘消息"></a>键盘消息</h3><p><code>WM_KEYDOWN</code> ：按键被按下时产生<br><code>WM_KEYUP</code>：按键被放开时产生<br><code>WM_SYSKEYDOWN</code>：系统键按下时产生比如ALT、F10等<br><code>WM_SYSKEYUP</code>：系统键放开时产生</p>
<p>附带信息:</p>
<p><code>WPARAM</code>：按键建Virtual Key<br><code>LPARAM</code>：按键的参数，例如按下次数</p>
<h3 id="鼠标消息"><a href="#鼠标消息" class="headerlink" title="鼠标消息"></a>鼠标消息</h3><p>基本鼠标消息：</p>
<p><code>WM_LBUTTONDOWN</code>：鼠标左键按下<br><code>WM_LBUTTONUP</code>：鼠标左键抬起<br><code>WM_RBUTTONDOWN</code>：鼠标右键按下<br><code>WM_RBUTTONUP</code>：鼠标右键抬起<br><code>WM_MOUSEMOVE</code>：鼠标移动消息</p>
<p>双击消息：</p>
<p><code>WM_LBUTTONDBLCLK</code>：鼠标左键双击<br><code>WM_RBUTTONDBLCLK</code>：鼠标右键双击</p>
<p>滚轮消息：</p>
<p><code>WM_MOUSEWHEEL</code>：鼠标滚轮消息</p>
<blockquote>
<p>一般滚轮的位移量为<code>120</code>的倍数 ( 正负均可 )</p>
</blockquote>
<p>附带信息∶</p>
<p><code>wPARAM</code>：其他按键的状态，例如Ctrl/Shift等<br><code>lPARAM</code>：鼠标的位置，窗口客户区坐标系。<br><code>LOWORD</code>：X 坐标位置<br><code>HIWORD</code>：Y 坐标位置</p>
<p>一般情况鼠标按下/抬起成对出现。在鼠标移动过程中，会根据移动速度产生一列的WM_MOUSEMOVE消息。同时使用双击消息处理时需要在注册窗口类的时候添加<code>CS_CBLCLKS</code>风格。</p>
<h3 id="定时器消息"><a href="#定时器消息" class="headerlink" title="定时器消息"></a>定时器消息</h3><p>定时器一般用于周期性执行的操作</p>
<p>产生时间</p>
<p>在程序中创建定时器，当到达时间间隔时，<code>GetMessage</code>会向程序发送一个<code>WM_TIMER</code>消息。定时器的精度是毫秒，但是准确度很低。例如设置时间间隔为1000ms，但是会在非1000毫秒到达消息。</p>
<blockquote>
<p>误差在毫秒级</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">UINT_PTR <span class="hljs-title">SetTimer</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,<span class="hljs-comment">//定时器窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT_PTR nIDEvent,<span class="hljs-comment">//定时器ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT uElapse,<span class="hljs-comment">//时间间隔(毫秒)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	TIMERPROC IpTimerFunc<span class="hljs-comment">//定时器处理函数指针(不使用则设置为NULL)</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span><span class="hljs-comment">//创建成功返回非零值</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>定时器的创建</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">UINT_PTR <span class="hljs-title">KillTimer</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,<span class="hljs-comment">//定时器窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT_PTR nIDEvent,<span class="hljs-comment">//定时器ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>销毁定时器</p>
</blockquote>
<p>附带信息</p>
<p><code>wPARAM</code>：定时器ID，用于区分时间到后是哪个定时器触发的<br><code>lPARAM</code>：定时器处理函数的指针</p>
<h2 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h2><p>绘图设备DC ( Device Context ) ，也称之为绘图上下文或绘图描述表</p>
<p>HDC - DC句柄，表示绘图设备</p>
<p>GDI - Windows graphics device interface ( Win32提供的绘图API )</p>
<h3 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h3><p>计算机使用红、绿、蓝，R -  <code>0 ～ 255</code>、G  -  <code>0 ～ 255</code>、B  -  <code>0 ～ 255</code><br>每一个点颜色是 3 个字节 24 位保存<code>0 - 2^24 - 1</code>，可以保存任意的颜色<br>16位：5，5，6  ( RGB )<br>32位：8，8，8，8  绘图或透明度 ( RGB+透明度 ) </p>
<h3 id="颜色的使用"><a href="#颜色的使用" class="headerlink" title="颜色的使用"></a>颜色的使用</h3><p><code>COLORREF</code>：实际DWORD ( unsigned long )<br>例如：<code>COLORREF nColor = 0;</code></p>
<p>赋值使用RGB宏</p>
<p>例如: <code>nColor = RGB(0,0，255);</code></p>
<p>获取RGB值</p>
<p><code>GetRValue/GetGValue/GetBValue</code><br>例如：<code>BYTE nRed = GetRValue( nColor );</code>返回对应颜色的配比是多少</p>
<h3 id="基本图形绘制"><a href="#基本图形绘制" class="headerlink" title="基本图形绘制"></a>基本图形绘制</h3><p><code>SetPixel</code>设置指定点的颜色 ( 画一个点 )</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">COLORREF <span class="hljs-title">SetPixel</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdc,<span class="hljs-comment">//DC句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> X,<span class="hljs-comment">//X坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> Y,<span class="hljs-comment">//Y坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	COLORREF crColor<span class="hljs-comment">//设置的颜色</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//返回点原来的颜色</span><br></code></pre></td></tr></table></figure>

<p>线的使用(直线、弧线)</p>
<p><code>MoveToEx</code>：指到窗口到目标点(从<code>(0,0)</code>到指定的点)，设置当前点<br><code>LineTo</code>：从窗口当前点到指定点绘制一条直线<br>当前点：上一次绘图时的最后一点，初始为<code>(0,0)</code>点。<br>封闭图形：能够用画刷填充的图形<code>Rectangle</code> ( 绘画直角矩形 ) / <code>Ellipse</code> ( 圆形 ) </p>
<h3 id="GDI-绘图对象"><a href="#GDI-绘图对象" class="headerlink" title="GDI 绘图对象"></a>GDI 绘图对象</h3><h4 id="画笔"><a href="#画笔" class="headerlink" title="画笔"></a>画笔</h4><p>画笔的作用</p>
<p>线的颜色、线型、线粗。<br><code>HPEN</code>：画笔句柄</p>
<p>画笔的创建</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HPEN <span class="hljs-title">CreatePen</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> fnPenStyle,<span class="hljs-comment">//画笔的样式</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nWidth,<span class="hljs-comment">//画笔的粗细</span></span></span><br><span class="hljs-params"><span class="hljs-function">	COLORREF crColor<span class="hljs-comment">//画笔的颜色</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//创建成功返回句柄</span><br></code></pre></td></tr></table></figure>

<p><code>PS_SOILD</code>：实心线，可以支持多个像素宽其他线型只能是一个像素宽。</p>
<blockquote>
<p>虚线画笔像素宽只能是 1，实心画笔可以是任意像素宽</p>
</blockquote>
<p>将画笔应用到DC中</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HGDIOBJ <span class="hljs-title">SelectObject</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdc,<span class="hljs-comment">//绘图设备句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HGDIOBJ hgdiobj<span class="hljs-comment">//GDI绘图对象句柄，画笔句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//返回原来的GDI绘图对象句柄</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意保存原来 DC 当中的画笔 ( 返回值 )，DC 使用完我们创建的画笔需要将其还回原来的画笔( 黑色 )</p>
</blockquote>
<p>将原来的画笔，使用<code>SelectObject</code>函数 ( 类似于交换 )，放入到设备DC中，就会将我们创建的画笔取出</p>
<p>释放画笔 ( 我们自己创建的画笔 )</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">DeleteObject</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HGDIOBJ hObject <span class="hljs-comment">//GDI绘图对象句柄，画笔句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>只能删除不被 DC 使用的画笔，所以在释放前，必须将画笔从DC中取出。</p>
</blockquote>
<h4 id="画刷"><a href="#画刷" class="headerlink" title="画刷"></a>画刷</h4><p>画刷-封闭图形的填充的颜色、图案<br>HBRUSH - 画刷句柄</p>
<p><code>CreateSolidBrush</code>：创建实心画刷 ( 填充单一颜色 )<br><code>CreateHatchBrush</code>：创建纹理画刷 ( 填充纹理线 )</p>
<p>之后同画笔一样，需要进行交换<code>(SelectObject)</code>和对创建的画刷句柄进行消除。</p>
<blockquote>
<p>初始画刷为白颜色，同时用直线围起来的图形即使封闭也不是封闭图形</p>
<p>可以使用<code>GetStockObject</code>函数获取系统维护的画刷、画笔等。调用的系统画刷不需要销毁，也无法使用<code>DeleteObject</code>进行销毁掉。</p>
<p>如果不使用画刷填充，需要使用<code>NULL_BRUSH</code>参数，获取不填充的画刷。<code>GetStockObject</code>返回的画刷不需要<code>DeleteObject</code>。</p>
</blockquote>
<h3 id="位图"><a href="#位图" class="headerlink" title="位图"></a>位图</h3><p>光栅图形 – 记录图像中每一点的颜色等信息。<br>矢量图形 – 记录图像算法、绘图指令等。<br>HBITMAP - 位图句柄</p>
<p>位图的使用</p>
<ul>
<li>在资源中添加位图资源</li>
<li>从资源中加载位图<code>LoadBitmap</code></li>
<li>创建一个与当前DC相匹配的DC ( 内存 DC )</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HDC <span class="hljs-title">CreateCompatibleDC</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdc <span class="hljs-comment">//当前DC句柄，可以为NULL(使用屏幕DC)</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//返回创建好的DC句柄</span><br></code></pre></td></tr></table></figure>

<ul>
<li>将位图放入匹配的DC中SelectObject</li>
<li>成像( 1:1 )</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">BitBlt</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdcDest,<span class="hljs-comment">//目的DC</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nXDest,<span class="hljs-comment">//目的左上X坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nYDest,<span class="hljs-comment">//目的左上Y坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nWidth,<span class="hljs-comment">//目的宽度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nHeight,<span class="hljs-comment">//目的高度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdcSrc,<span class="hljs-comment">//源DC</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nXSrc，<span class="hljs-comment">//源左上X坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nYSrc,<span class="hljs-comment">//源左上Y坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwRop <span class="hljs-comment">//成像方法  SRCCOPY (原样成像)</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>缩放成像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">StretchBlt</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdcDest,<span class="hljs-comment">// handle to destination DC</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nXOriginDest,<span class="hljs-comment">// x-coord of destination upper-left corner</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nYOriginDest,<span class="hljs-comment">// y-coord of destination upper-left corner</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nWidthDest,<span class="hljs-comment">// width of destination rectangle</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nHeightDest,<span class="hljs-comment">// height of destination rectangle</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hdcSrc,<span class="hljs-comment">// handle to source DC</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nXOriginSrc，<span class="hljs-comment">// x-coord of source upper-left corner</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nYOriginSrc,<span class="hljs-comment">// y-coord of source upper-left corner</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nWidthSrc,<span class="hljs-comment">//源DC宽</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nHeightSrc,<span class="hljs-comment">//源DC高</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwRop<span class="hljs-comment">// raster operation code</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>


</blockquote>
<ul>
<li><p>取出位图 <code>( SelectObject )</code></p>
</li>
<li><p>释放位图 <code>( DelectObject )</code></p>
</li>
<li><p>释放匹配的 DC <code>(DeleteObject)</code></p>
</li>
</ul>
<h3 id="文字的绘制"><a href="#文字的绘制" class="headerlink" title="文字的绘制"></a>文字的绘制</h3><p><code>TextOut</code>：将文字绘制在指定坐标位置 ( 只能绘制单行 )</p>
<p><code>DrawText</code>：可以绘制矩形框的字符串</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">DrawText</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HDC hDC,<span class="hljs-comment">//DC句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpString,<span class="hljs-comment">//字符串</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nCount,<span class="hljs-comment">//字符数量</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPRECT lpRect,<span class="hljs-comment">//绘制文字的矩形框</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT uFormat<span class="hljs-comment">//绘制的方式</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>文字颜色和背景</p>
<p>文字颜色:：<code>SetTextColor</code><br>文字背景色：<code>SetBkColor</code> 只适用于不透明模式下<br>文字背景模式：<code>SetBkMode</code> (OPAQUE 不透明模式 / TRANSPARENT 透明模式)</p>
<p>字体</p>
<p><code>Windows</code>常用的字体为<code>TrueType</code>格式的字体文件</p>
<p>创建字体</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HFONT <span class="hljs-title">CreateFont</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nHeight,<span class="hljs-comment">//字体高度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nWidth,<span class="hljs-comment">//字体宽度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nEscapement,<span class="hljs-comment">//字符串倾斜角度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nOrientation,<span class="hljs-comment">//字符旋转角度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> fnWeight,<span class="hljs-comment">//字体的粗细</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwltalic,<span class="hljs-comment">//斜体 0：不为斜体  1：斜体</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwUnderline,<span class="hljs-comment">//字符下划线</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwStrikeOut,<span class="hljs-comment">//删除线</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwCharSet,<span class="hljs-comment">//字符集 GB312</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwOutputPrecision,<span class="hljs-comment">//输出精度 (已废弃，赋值为 0 即可)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DwORD fdwClipPrecision,<span class="hljs-comment">//剪切精度 (已废弃，赋值为 0 即可)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwQuality,<span class="hljs-comment">//输出质量 (已废弃，赋值为 0 即可)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD fdwPitchAndFamily,<span class="hljs-comment">//匹配字体</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpszFace <span class="hljs-comment">//字体名称</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<h2 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h2><h3 id="对话框的分类"><a href="#对话框的分类" class="headerlink" title="对话框的分类"></a>对话框的分类</h3><p>模式对话框–当对话框显示时，会禁止其他窗口和用户交互操作。<br>无模式对话框–在对话框显示后，其他窗口仍然可以和用户交互操作。</p>
<h3 id="对话框基本使用"><a href="#对话框基本使用" class="headerlink" title="对话框基本使用"></a>对话框基本使用</h3><ol>
<li>对话框窗口处理函数</li>
<li>注册窗口类（不使用)</li>
<li>创建对话框</li>
<li>对话框的关闭</li>
</ol>
<h3 id="对话框窗口处理函数"><a href="#对话框窗口处理函数" class="headerlink" title="对话框窗口处理函数"></a>对话框窗口处理函数</h3><blockquote>
<p>并非真正的对话框窗口处理函数</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">INT CALLBACK <span class="hljs-title">DialogProc</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hwndDlg，<span class="hljs-comment">//窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT uMsg,<span class="hljs-comment">//消息ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	WPARAM wParam,<span class="hljs-comment">//消息参数</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPARAM lParam <span class="hljs-comment">//消息参数</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>返回<code>TRUE</code>：缺省处理函数不需要处理。<br>返回<code>FALSE</code>：交给缺省处理函数处理。<br>不需要调用缺省对话框窗口处理函数。</p>
<h3 id="创建对话框"><a href="#创建对话框" class="headerlink" title="创建对话框"></a>创建对话框</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">INT <span class="hljs-title">DialogBox</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,<span class="hljs-comment">//应用程序实例句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpTemplate,<span class="hljs-comment">//对话框资源ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWndParent,<span class="hljs-comment">//对话框父窗口</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DLGPROC lpDialogFunc<span class="hljs-comment">//自定义函数</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure>

<p><code>DialogBox</code>是一个阻塞函数，只有当对话框关闭后，才会返回，继续执行后续代码。</p>
<p>返回值是通过<code>EndDialog</code>设置。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HWND <span class="hljs-title">CreateDialog</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,<span class="hljs-comment">//应用程序实例句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpTemplate,<span class="hljs-comment">//对话框资源ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWndParent,<span class="hljs-comment">//对话框父窗口</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DLGPROC lpDialogFunc<span class="hljs-comment">//自定义函数</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure>

<p>非阻塞函数，创建成功返回窗口句柄，需要使用<code>ShowWindow</code>函数显示对话框</p>
<p>关闭时使用<code>DestroyWindow</code>销毁窗口，不能使用<code>EndDialog</code>关闭对话框。</p>
<h3 id="对话框的关闭"><a href="#对话框的关闭" class="headerlink" title="对话框的关闭"></a>对话框的关闭</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">EndDialog</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hDlg,<span class="hljs-comment">//关闭的对话框窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	INT_PTR nResult,<span class="hljs-comment">//关闭的返回值</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>关闭模式对话框，只能使用<code>EndDialog</code>，不能使用<code>DestroyWindow</code>等函数。<code>nResult</code>是<code>DialogBox</code>函数退出时的返回值。</p>
<p>关闭非模式对话框，关闭时使用<code>DestroyWindow</code>销毁窗口，不能使用<code>EndDialog</code>关闭对话框。</p>
<h3 id="对话框的消息"><a href="#对话框的消息" class="headerlink" title="对话框的消息"></a>对话框的消息</h3><p><code>WM_INITDIALOG</code>：对话框创建之后显示之前，通知对话框窗口处理函数，可以完成自己的初始化相关的操作。</p>
<h2 id="静态库"><a href="#静态库" class="headerlink" title="静态库"></a>静态库</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>运行不存在，静态库源码被链接到调用程序中，目标程序的归档。</p>
<blockquote>
<p><code>C</code>在<code>Windows</code>下直接编译不连接不需要对函数进行声明即可调用，但是<code>C++</code>需要对函数进行申明</p>
</blockquote>
<h3 id="C-静态库的使用"><a href="#C-静态库的使用" class="headerlink" title="C 静态库的使用"></a>C 静态库的使用</h3><p>库路径设置:可以使用<code>pragma</code>关键字设置<code>#pragma comment( lib，&quot;../lib/clib.lib”)</code></p>
<h3 id="C-静态库的创建"><a href="#C-静态库的创建" class="headerlink" title="C++ 静态库的创建"></a>C++ 静态库的创建</h3><ol>
<li>创建一个静态库项目。</li>
<li>添加库程序，源文件使用CPP文件。</li>
</ol>
<h3 id="C-静态库的使用-1"><a href="#C-静态库的使用-1" class="headerlink" title="C++静态库的使用"></a>C++静态库的使用</h3><p>库路径设置：可以使用<code>pragma</code>关键字设置<code>#pragma comment( lib,&quot;../lib/cpplib.lib”)</code></p>
<blockquote>
<p><code>C++</code>在处理函数时会对函数进行换名，因此在<code>C++</code>中调用<code>C</code>静态库会找不到，而无法使用</p>
<p>可以在调用的<code>C</code>静态库的函数声明前加一个<code>extern &quot;C&quot;</code></p>
</blockquote>
<h2 id="动态库"><a href="#动态库" class="headerlink" title="动态库"></a>动态库</h2><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ol>
<li>运行时独立存在</li>
<li>源码不会链接到执行程序</li>
<li>使用时加载(使用动态库必须使动态库执行)</li>
</ol>
<p>与静态库的比较︰</p>
<p>由于静态库是将代码嵌入到使用程序中，多个程序使用时，会有多份代码，所以代码体积会增大。动态库的代码只需要存在一份，其他程序通过函数地址使用，所以代码体积小。<br>静态库发生变化后，新的代码需要重新链接嵌入到执行程序中。动态库发生变化后，如果库中函数的定义（或地址)未变化，其他使用<code>DLL</code>的程序不需重新链接。</p>
<h3 id="创建动态库项目"><a href="#创建动态库项目" class="headerlink" title="创建动态库项目"></a>创建动态库项目</h3><p>添加库程序</p>
<p>库程序导出–提供给使用者库中的函数等信息。</p>
<ol>
<li>声明导出︰使用<code>_declspec(dllexport)</code>导出函数，用该方法导出的函数名字会被替换 ( C++ )</li>
</ol>
<blockquote>
<p>注意：动态库编译链接后，也会有<code>lib</code>文件，是作为动态库函数映射使用，与静态库不完全相同。</p>
</blockquote>
<ol start="2">
<li>模块定义文件.def</li>
</ol>
<p>例如</p>
<p><code>LIBRARY DLLFunc //库</code><br><code>EXPORTS //库导出表</code><br><code>DLL_Mul    @1 //导出的函数</code></p>
<blockquote>
<p><code>dll</code>文件中将函数导出后会将定义的函数的地址放在文件头，之后放定义函数的源码</p>
</blockquote>
<h3 id="动态库的使用"><a href="#动态库的使用" class="headerlink" title="动态库的使用"></a>动态库的使用</h3><p><strong>隐式链接</strong>(操作系统负责使动态库执行)</p>
<ol>
<li>头文件和函数原型</li>
</ol>
<p>​    可以在函数原型的声明前，增加<code>_declspec(dllimport))</code></p>
<ol start="2">
<li>导入动态库的LIB文件</li>
<li>在程序中使用函数</li>
<li>隐式链接的情况，dll文件可以存放的路径︰<ol>
<li>与执行文件中同一个目录下</li>
<li>当前工作目录</li>
<li>Windows 目录</li>
<li>Windows / System32 目录</li>
<li>Windows / System</li>
<li>环境变量<code>PATH</code>指定目录</li>
</ol>
</li>
</ol>
<blockquote>
<p>程序通过定位到<code>lib</code>文件之后取其中的编号，而对引用的函数进行加载</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">_declspec(dllimport) XXX <span class="hljs-comment">//定义的函数申明 ( C++ )</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment (lib,<span class="hljs-meta-string">&quot;lib文件路径&quot;</span>)</span><br></code></pre></td></tr></table></figure>
</blockquote>
<p><strong>显示链接</strong>(程序员自己负责使动态库执行)</p>
<ol>
<li><p>定义函数指针类型typedef</p>
</li>
<li><p>加载动态库</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HMODULE <span class="hljs-title">LoadLibrary</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpFileName <span class="hljs-comment">//动态库文件名或全路径</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//返回DLL的实例句柄 (HINSTANCE)</span><br></code></pre></td></tr></table></figure></li>
<li><p>获取函数地址 ( 绝对 / 真实地址 )</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">FARPROC <span class="hljs-title">GetProcAddress</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HMODULE hModule,<span class="hljs-comment">//DLL句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCSTR lpProcName <span class="hljs-comment">//函数名称</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//成功返回函数地址</span><br></code></pre></td></tr></table></figure></li>
<li><p>使用函数</p>
</li>
<li><p>卸载动态库</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">FreeLibrary</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HMODULE hModule <span class="hljs-comment">//DLL的实例句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>如果出现加载的函数的地址为 0 的情况，可以在<code>dll</code>项目的文件中加入一个文件头，包含以下内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __DLLEXPORT</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __DLL_EXP _declspec(dllexport) </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __DLL_EXP _declspec(dllimport) </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> </span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> __DLL_EXP 定义的函数<br></code></pre></td></tr></table></figure>

<p>添加完后再次生成<code>dll</code>文件即可</p>
</blockquote>
<h3 id="动态库封装类"><a href="#动态库封装类" class="headerlink" title="动态库封装类"></a>动态库封装类</h3><p>在类名称前增加<code>_declspec(dllexport)</code>定义，例如∶</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">declspec</span>(<span class="hljs-title">dllexport</span>) <span class="hljs-title">CMath</span> &#123;</span><br>    XXX<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>通常使用预编译开关切换类的导入导出定义，例如∶</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> DLLCLASS_EXPORTS</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EXT_CLASS _declspec(dllexport)<span class="hljs-comment">//DLL</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EXT_CLASS_declspec(dllimport)<span class="hljs-comment">//使用者</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EXT_CLASS</span> <span class="hljs-title">CMath</span>&#123;</span><br>	XXX <br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p><code>Windows</code>线程是可以执行的代码的实例。系统是以线程为单位调度程序。一序当中可以有多个线程，实现多任务的处理。</p>
<p> Windows 线程的特点︰</p>
<ol>
<li>线程都具有1个ID</li>
<li>每个线程都具有自己的内存栈</li>
<li>同一进程中的线程使用同一个地址空间。</li>
</ol>
<p>线程的调度：</p>
<p>将CPU的执行时间划分成时间片，依次根据时间片执行不同的线程。</p>
<p>线程轮询：</p>
<p>线程A-&gt;线程B-&gt;线程A……</p>
<h3 id="创建一个线程"><a href="#创建一个线程" class="headerlink" title="创建一个线程"></a>创建一个线程</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HANDLE <span class="hljs-title">CreateThread</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPSECURITY_ATTRIBUTES IpThreadAttributes,<span class="hljs-comment">//安全属性(已经废弃，直接置空)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	SIZE_T dwStackSize,<span class="hljs-comment">//线程栈的大小(按一兆进行对齐)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPTHREAD_START_ROUTINE lpStartAddress,<span class="hljs-comment">//线程处理函数的函数地址</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPVOID IpParameter,<span class="hljs-comment">//传递给线程处理函数的参数(void* 类型)</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwCreationFlags,<span class="hljs-comment">//线程的创建方式 0:立刻执行 CREATE_SUSPENDED:挂起</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPDWORD IpThreadId <span class="hljs-comment">//创建成功，返回线程的ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//创建成功，返回线程句柄</span><br></code></pre></td></tr></table></figure>

<h3 id="处理函数"><a href="#处理函数" class="headerlink" title="处理函数"></a>处理函数</h3><p>线程处理函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">DWORD WINAPI <span class="hljs-title">ThreadProc</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPVOID lpParameter <span class="hljs-comment">//创建线程时，传递给线程的参数</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>挂起线程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">SuspendThread(HANDLE hThread)<span class="hljs-comment">//线程句柄</span><br></code></pre></td></tr></table></figure>

<p>恢复线程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">ResumeThread(HANDLE hThread)<span class="hljs-comment">//线程句柄</span><br></code></pre></td></tr></table></figure>

<p>结束指定线程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL Terminate <span class="hljs-title">Thread</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hThread,<span class="hljs-comment">//线程句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwExitCode<span class="hljs-comment">//退出码</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>类似于”杀人”，输入对应线程的句柄就可以结束对应线程</p>
</blockquote>
<p>结束函数所在的线程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">VOID <span class="hljs-title">ExitThread</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwExitCode<span class="hljs-comment">//退出线程码</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>类似于”自杀”，哪个线程调用，哪个线程就结束</p>
</blockquote>
<p>获取线程的ID：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">GetCurrentThreadId()<br></code></pre></td></tr></table></figure>

<p>获取当前线程的句柄：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">GetCurrentThread()<br></code></pre></td></tr></table></figure>

<p>等候单个句柄有信号：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">VOID <span class="hljs-title">WaitForSingleObject</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE handle，<span class="hljs-comment">//句柄BUFF的地址</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwMilliseconds<span class="hljs-comment">//最大等候时间(以毫秒为单位)   INFINITE (等候时间无限大)</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>可等候的句柄，需要包括有信号和无信号两个状态，可以是一个线程句柄。如果程序无信号(最大等候时间内)，该函数会阻塞，等候有信号时停止阻塞</p>
</blockquote>
<p>同时等候多个句柄有信号：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">DWORD <span class="hljs-title">WaitForMultipleObjects</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD nCount,<span class="hljs-comment">//句柄数量</span></span></span><br><span class="hljs-params"><span class="hljs-function">	CONST HANDLE*lpHandles,<span class="hljs-comment">//句柄BUFF的地址</span></span></span><br><span class="hljs-params"><span class="hljs-function">	BOOL bWaitAll,<span class="hljs-comment">//等候方式</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwMilliseconds<span class="hljs-comment">//等候时间INFINITE</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>bWaitAll</code>等候方式：</p>
<p><code>TRUE</code>：表示所有句柄都有信号，才结束等候<br><code>FASLE</code>：表示句柄中只要有一个有信号，就结束等候。</p>
<p>当线程执行中时，该线程无信号，当线程结束时才产生信号。</p>
</blockquote>
<h3 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h3><h4 id="原子锁"><a href="#原子锁" class="headerlink" title="原子锁"></a>原子锁</h4><h5 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h5><p>多个线程对同一个数据进行原子操作，会产生结果丢失。比如执行<code>++</code>运算时。</p>
<h5 id="错误代码分析"><a href="#错误代码分析" class="headerlink" title="错误代码分析"></a>错误代码分析</h5><p>当线程A执行<code>a value++</code>时，如果线程切换时间正好是在线程A将值保存到<code>a value</code>之前，线程B继续执行<code>g_value++</code>，那么当线程A再次被切换回来之后，会将原来线程A保存的值保存到<code>g_value上</code>，线程B进行的加法操作被覆盖。</p>
<blockquote>
<p>一般被<code>CPU</code>切换出该线程时，程序会将当前运行状态进行压栈保存( 每个进程都有独立的栈空间 )</p>
<img src="https://s2.loli.net/2022/04/09/I1lEPyRSDTWdf5o.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />

<p>以上图为例，当线程一再执行完语句一后，被<code>CPU</code>切换到线程二，线程一的数据进行压栈保存，线程二完整的执行完了对应的全部代码，此时切换回到线程一，栈中的数据弹出，执行语句三，而导致线程一的语句一的数据未被保存，而导致丢失了数据。</p>
</blockquote>
<h5 id="使用原子锁函数"><a href="#使用原子锁函数" class="headerlink" title="使用原子锁函数"></a>使用原子锁函数</h5><p><code>InterlockedIncrement(long*)</code> 对<code>++</code>操作符进行加锁</p>
<blockquote>
<p>对传入的数据进行加一运算，当运行时间超过了等待时间，仍然会被操作系统切换到其他线程，当该线程无法进行加锁时会造成阻塞，只能等待切换线程。</p>
</blockquote>
<p><code>InterlockedDecrement</code> 对<code>--</code>操作符进行加锁<br><code>InterlockedCompareExchange</code> 对比较进行加锁<br><code>InterlockedExchange</code> 对交换进行加锁</p>
<h5 id="原子锁的实现"><a href="#原子锁的实现" class="headerlink" title="原子锁的实现"></a>原子锁的实现</h5><p>直接对数据所在的内存操作，并且在任何一个瞬间只能有一个线程访问。</p>
<h4 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h4><blockquote>
<p>效率不如原子锁，但是原子锁能实现的互斥锁均能实现</p>
</blockquote>
<h5 id="相关的问题"><a href="#相关的问题" class="headerlink" title="相关的问题"></a>相关的问题</h5><p>多线程下代码或资源的共享使用。</p>
<h5 id="互斥的使用"><a href="#互斥的使用" class="headerlink" title="互斥的使用"></a>互斥的使用</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HANDLE <span class="hljs-title">CreateMutex</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPSECURITY_ATTRIBUTES IpMutexAttributes,<span class="hljs-comment">//安全属性</span></span></span><br><span class="hljs-params"><span class="hljs-function">	BOOL bInitialOwner,<span class="hljs-comment">//初始的拥有者(哪个线程创建的就被哪个线程拥有) TRUE/FALSE</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpName<span class="hljs-comment">//命名</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span><span class="hljs-comment">//创建成功返回互斥句柄</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>在任何时间点上，只能有一个线程拥有互斥，具有独占性和排他性，当任何一个线程不拥有互斥时其拥有信号，但是当拥有互斥时其变为无信号。</p>
</blockquote>
<p><code>WaitForSingleObject /  WaitForMultipleObjects</code>互斥的等候遵循谁先等候谁先获取。</p>
<h5 id="释放互斥"><a href="#释放互斥" class="headerlink" title="释放互斥"></a>释放互斥</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">ReleaseMutex</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hMutex <span class="hljs-comment">// handle to mutex</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<h5 id="关闭互斥句柄"><a href="#关闭互斥句柄" class="headerlink" title="关闭互斥句柄"></a>关闭互斥句柄</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">CloseHandle</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hObject</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h4><h5 id="相关问题-1"><a href="#相关问题-1" class="headerlink" title="相关问题"></a>相关问题</h5><p>解决程序之间的通知的问题。</p>
<h5 id="事件的使用"><a href="#事件的使用" class="headerlink" title="事件的使用"></a>事件的使用</h5><p>创建事件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HANDLE <span class="hljs-title">CreateEvent</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPSECURITY_ATTRIBUTES lpEventAttributes,<span class="hljs-comment">//安全属性</span></span></span><br><span class="hljs-params"><span class="hljs-function">	BOOL bManualReset,<span class="hljs-comment">//事件重置（复位)方式，TRUE手动，FALSE自动</span></span></span><br><span class="hljs-params"><span class="hljs-function">	BOOL bInitialState,<span class="hljs-comment">//事件初始状态，TRUE有信号</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpName <span class="hljs-comment">//事件命名</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span><span class="hljs-comment">//创建成功返回事件句柄</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>时间也具备有信号和无信号两个状态</p>
</blockquote>
<p>等候事件</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">WaitForSingleObject</span> / WaitForMultipleObjects<br></code></pre></td></tr></table></figure>

<p>触发事件(将事件设置成有信号状态)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">SetEvent</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hEvent<span class="hljs-comment">// handle to event</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>关闭事件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">CloseHandle</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hObject</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>注意：小心事件的死锁。</p>
<h4 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h4><h5 id="相关的问题-1"><a href="#相关的问题-1" class="headerlink" title="相关的问题"></a>相关的问题</h5><p>类似于事件，解决通知的相关问题。但提供一个计数器，可以设置次数。</p>
<h5 id="信号量的使用"><a href="#信号量的使用" class="headerlink" title="信号量的使用"></a>信号量的使用</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HANDLE <span class="hljs-title">CreateSemaphore</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPSECURITY_ATTRIBUTES lpSemaphoreAttributes,<span class="hljs-comment">//安全属性</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LONG lInitialCount,<span class="hljs-comment">//初始化信号量数量</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LONG lMaximumCount,<span class="hljs-comment">//信号量的最大值</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpName<span class="hljs-comment">//命名</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span><span class="hljs-comment">//创建成功返回信号量句柄</span></span><br></code></pre></td></tr></table></figure>

<h5 id="等候信号量"><a href="#等候信号量" class="headerlink" title="等候信号量"></a>等候信号量</h5><p><code>WaitForSingleObject /  WaitForMultipleObjects</code>每等候通过一次，信号量的信号减1，直到为 0 阻塞</p>
<h5 id="给信号量指定计数值"><a href="#给信号量指定计数值" class="headerlink" title="给信号量指定计数值"></a>给信号量指定计数值</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">ReleaseSemaphore</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hSemaphore,<span class="hljs-comment">//信号量句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LONG lReleaseCount,<span class="hljs-comment">//释放数量</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPLONG lpPreviousCount<span class="hljs-comment">//释放前原来信号量的数量，可以为NULL</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<p>关闭句柄</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">CloseHandle</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HANDLE hObject</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<h2 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> WINAPI <span class="hljs-title">WinMain</span><span class="hljs-params">( </span></span><br><span class="hljs-params"><span class="hljs-function">    HINSTANCE hInstance,		<span class="hljs-comment">//当前程序的实例句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">    HINSTANCE hPrevInstance,	<span class="hljs-comment">//当前程序前一个实例句柄 (已经废弃)</span></span></span><br><span class="hljs-params"><span class="hljs-function">    LPWSTR    lpCmdLine,		<span class="hljs-comment">//命令行参数字符串 (char* 类型)</span></span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">int</span>       nCmdShow			<span class="hljs-comment">//窗口显示方式 (最大化、最小化、原样显示)</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;	<br></code></pre></td></tr></table></figure>

<blockquote>
<p>句柄一个拿来找到内存的东西，但不是指针，句柄类型定义以<code>H</code>开头</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MessageBox</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,				<span class="hljs-comment">//父窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpText,			<span class="hljs-comment">//显示在消息框中的文字</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR IpCaption,		<span class="hljs-comment">//显示在标题栏中的文字</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT uType				<span class="hljs-comment">//消息框中的按钮、图标显示类型 (unsigned int) </span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<span class="hljs-comment">//返回点击的按钮ID</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>MessageBox</code>是一个阻塞函数，当提示框弹出时便阻塞了，当点击了按钮后终止阻塞</p>
<p><code>uType</code>按钮参数：</p>
<table>
<thead>
<tr>
<th>按钮参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>MB_OK</td>
<td>默认值。有一个确认按钮在里面。</td>
</tr>
<tr>
<td>MB_YESNO</td>
<td>有是和否在里面。</td>
</tr>
<tr>
<td>MB_ABORTRETRYIGNORE</td>
<td>有Abort（放弃），Retry（重试）和Ignore（跳过）</td>
</tr>
<tr>
<td>MB_YESNOCANCEL</td>
<td>消息框含有三个按钮：Yes，No和Cancel</td>
</tr>
<tr>
<td>MB_RETRYCANCEL</td>
<td>有Retry（重试）和Cancel（取消）</td>
</tr>
<tr>
<td>MB_OKCANCEL</td>
<td>消息框含有两个按钮：OK和Cancel</td>
</tr>
</tbody></table>
<p>图标：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>MB_ICONEXCLAMATION</td>
<td>一个惊叹号出现在消息框</td>
</tr>
<tr>
<td>MB_ICONWARNING</td>
<td>一个惊叹号出现在消息框</td>
</tr>
<tr>
<td>MB_ICONINFORMATION</td>
<td>一个圆圈中小写字母 i 组成的图标出现在消息框</td>
</tr>
<tr>
<td>MB_ICONASTERISK</td>
<td>一个圆圈中小写字母 i 组成的图标出现在消息框</td>
</tr>
<tr>
<td>MB_ICONQUESTION</td>
<td>一个问题标记图标出现在消息框</td>
</tr>
<tr>
<td>MB_ICONSTOP</td>
<td>一个停止消息图标出现在消息框</td>
</tr>
<tr>
<td>MB_ICONERROR</td>
<td>一个停止消息图标出现在消息框</td>
</tr>
<tr>
<td>MB_ICONHAND</td>
<td>一个停止消息图标出现在消息框</td>
</tr>
</tbody></table>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">ATOM <span class="hljs-title">RegisterClass</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	CONST WNDCLASS* IpWndClass		<span class="hljs-comment">//窗口类的数据</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span><span class="hljs-comment">//注册成功后，返回一个数标识</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>注册窗口类的结构体</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">WNDCLASS</span>&#123;</span><br>	UINT style;				<span class="hljs-comment">//窗口类风格</span><br>	WNDPROC IpfnWndroc;		<span class="hljs-comment">//窗口处理函数</span><br>	<span class="hljs-keyword">int</span> cbClsExtra;			<span class="hljs-comment">//窗口类的附加数据buff的大小(开缓冲区大小[字节])</span><br>	<span class="hljs-keyword">int</span> cbWndExtra;			<span class="hljs-comment">//窗口的附加数据buff的大小(开缓冲区大小[字节])</span><br>	HINSTANCE hInstance;	<span class="hljs-comment">//当前模块的实例句柄</span><br>	HICON hIcon;			<span class="hljs-comment">//窗口图标句柄</span><br>	HCURSOR hCursor;		<span class="hljs-comment">//鼠标的句柄</span><br>	HBRUSH hbrBackground;	<span class="hljs-comment">//绘制窗口背景的画刷句柄</span><br>	LPCTSTR IpszMenuName;	<span class="hljs-comment">//窗口菜单的资源ID字符串</span><br>	LPCTSR IpszClassName;	<span class="hljs-comment">//窗口类名称</span><br>&#125;WNDCLASS,*PWNDCLASS;<br></code></pre></td></tr></table></figure>

<p><code>style</code>风格：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">CS_HREDRAW - 当窗口水平变化时，窗口重新绘制<br>CS_VREDRAW - 当窗口垂直变化时，窗口重新绘制<br>CS_DCLCLKS - 允许窗口接收鼠标双击<br>CS_NOCLOSE - 窗口没有关闭按钮<br></code></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">HWND <span class="hljs-title">CreateWindowEx</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwExStyle,		<span class="hljs-comment">//窗口的扩展风格</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpClassName，	<span class="hljs-comment">//已经注册的窗口类名称</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPCTSTR lpWindowName,	<span class="hljs-comment">//窗口标题栏的名字</span></span></span><br><span class="hljs-params"><span class="hljs-function">	DWORD dwStyle,			<span class="hljs-comment">//窗口的基本风格</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> x,	<span class="hljs-comment">//窗口左上角水平坐标位置</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> y,	<span class="hljs-comment">//窗口左上角垂直坐标位置</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nWidth,	<span class="hljs-comment">//窗口的宽度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	<span class="hljs-keyword">int</span> nHeight,	<span class="hljs-comment">//窗口的高度</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWndParent,	<span class="hljs-comment">//窗口的父窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HMENU hMenu,	<span class="hljs-comment">//窗口菜单句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HINSTANCE hInstance,	<span class="hljs-comment">//应用程序实例句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPVOID lpParam	<span class="hljs-comment">//窗口创建时附加参数</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;	<span class="hljs-comment">//创建成功返回窗口句</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>窗口创建</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">LRESULT CALLBACK <span class="hljs-title">WnfProc</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd, <span class="hljs-comment">//窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT msgID, <span class="hljs-comment">//消息ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	WPARAM wParam, <span class="hljs-comment">//消息参数</span></span></span><br><span class="hljs-params"><span class="hljs-function">	LPARAM lPARAM<span class="hljs-comment">//消息参数</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>消息处理函数，通过用户自定义来对产生的消息进行处理</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">GetMessage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	LPMSG IpMsg,<span class="hljs-comment">//存放获取到的消息BUFF</span></span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,<span class="hljs-comment">//窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT wMsgFilterMin,<span class="hljs-comment">//获取消息的最小ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">	UINT wMsgFilterMax<span class="hljs-comment">//获取消息的最大ID</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>IpMsg</code>：当获取到消息后，将消息的参数存放到<code>MSG</code>结构中<br><code>hWnd</code>：获取<code>hWnd</code>所指定窗口的消息<br><code>wMsgFilterMax</code>和<code>wMsgFilterMin</code>：只能获取到由它们指定的消息范围内的消息，如果都为<code>0</code>，表示没有范围。</p>
<p>返回值：</p>
<p>抓到<code>WM_QUIT</code>返回零值，否则返回非零值。<br><code>PostQuitMessage(0)</code>可以发送一个<code>WM_QUIT</code>消息，使其返回</p>
<p>在程序（线程）消息队列查找消息，如果队列有消息，检查消息是否满足指定条件(HWND,ID范围)，不满足条件就不会取出消息，否则从队列取出消息返回。<br>如果程序（线程）消息队列没有消息，向系统消息队列获取属于本程序的消息。如果系统队列的当前消息属于本程序，系统会将消息转发到程序消息队列中。<br>如果系统消息队列也没有消息，检查当前进程的所有窗口的需要重新绘制的区域，如果发现有需要绘制的区域，产生<code>WM_PAINT</code>消息，取得消息返回处理。<br>如果没有重新绘制区域，检查定时器如果有到时的定时器，产生<code>WM_TIMER</code>,返回处理执行。<br><code>GetMessage</code>会继续等候下一条消息。<code>PeekMessage</code>会返回<code>FALSE</code>，交出程序的控制权。<br>注意：<code>GetMessage</code>如果获取到是<code>WM_QUIT</code>,函数会返回<code>FALSE</code>。<br>如果没有到时的定时器，整理程序的资源、内存等等。</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOOL <span class="hljs-title">TranslateMessage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	CONST MSG* IpMsg	<span class="hljs-comment">//要翻译的消息地址</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>翻译消息( 对于可见字符 )，将键盘消息翻译成字符消息。<br>检查消息是否是按键的消息，如果不是按键消息，不做任何处理，继续执行。</p>
<p><code>TranslateMessage</code>在转换<code>WM_KEYDOWN</code>消息时，对于可见字符可以产生<code>WM_CHAR</code>,不可见字符无此消息。</p>
<p>附带信息∶</p>
<p><code>WPARAM</code>：输入的字符的<code>ASCII</code>字符编码值<br><code>LPARAM</code>：按键的相关参数</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">LRESULT <span class="hljs-title">DispatchMessage</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	CONST MSG* Ipmsg<span class="hljs-comment">//要派发的消息</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>将消息派发到该消息所属的窗口处理函数上</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">BOLL <span class="hljs-title">InvalidateRect</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">	HWND hWnd,<span class="hljs-comment">//窗口句柄</span></span></span><br><span class="hljs-params"><span class="hljs-function">	CONST RECT* IpRect,<span class="hljs-comment">//区域的矩形坐标</span></span></span><br><span class="hljs-params"><span class="hljs-function">	BOOL bErase<span class="hljs-comment">//重绘前是否先擦除 TURE 表示擦除 FALSE 标识不擦除</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>申明窗口无效区域：需要重新绘制的区域</p>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Win32/" class="category-chain-item">Win32</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Win 32 编程</div>
      <div>https://equinox-shame.github.io/2022/04/07/Win32 编程/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Beitragsautor</div>
          <div>梓曰</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Veröffentlicht am</div>
          <div>April 7, 2022</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Urheberrechtshinweis</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/12/DebugMe/" title="SMC 逆向分析">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">SMC 逆向分析</span>
                        <span class="visible-mobile">Vorheriger</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/04/03/Bomb%20Lab/" title="CSAPP - Bomb Lab">
                        <span class="hidden-mobile">CSAPP - Bomb Lab</span>
                        <span class="visible-mobile">Nächster</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"2aM6IUUWOeDGCZaDdRhrvLam-gzGzoHsz","appKey":"GQdXw2PjI9DScgw5QHVCZeYm","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Inhaltsverzeichnis</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Suchen</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Stichwort</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://equinox-shame.github.io" target="_blank" rel="nofollow noopener"><span>梓曰</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        Alle Aufrufe: 
        <span id="leancloud-site-pv"></span>
        
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        Alle Besucher: 
        <span id="leancloud-site-uv"></span>
        
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog funktioniert am besten mit aktiviertem JavaScript</div>
  </noscript>
</body>
</html>
